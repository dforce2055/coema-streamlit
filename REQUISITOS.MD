# COEMA - Sistema de FacturaciÃ³n ElÃ©ctrica
## Documento de AnÃ¡lisis y Requisitos

**Fecha:** Enero 2026  
**Cliente:** Cooperativa de ProvisiÃ³n de EnergÃ­a ElÃ©ctrica y Otros Servicios de Madariaga Ltda.  
**UbicaciÃ³n:** General Madariaga, Buenos Aires, Argentina

---

## 1. Resumen Ejecutivo

COEMA necesita modernizar su sistema de facturaciÃ³n elÃ©ctrica. Los problemas actuales son:
- Sistema de facturaciÃ³n lento e ineficiente
- Lecturas de medidores aproximadas (no reales)
- Necesidad de integraciÃ³n con sistemas externos vÃ­a API

**Objetivo de la Demo:** Crear un prototipo funcional que calcule facturas elÃ©ctricas basÃ¡ndose en el consumo en kWh y las variables tarifarias del abonado.

---

## 2. Preguntas Pendientes para COEMA

### 2.1 Sobre Tarifas y CategorÃ­as

| # | Pregunta | Impacto |
|---|----------|---------|
| 1 | Â¿CuÃ¡ntos tipos de tarifa existen ademÃ¡s de T1R y T1RE? | Estructura de datos |
| 2 | Â¿QuÃ© determina si un cliente es T1R o T1RE? Â¿Es solo la condiciÃ³n fiscal? | Reglas de negocio |
| 3 | Â¿Existen tarifas comerciales, industriales, rurales? | Alcance del sistema |
| 4 | Â¿CÃ³mo se definen los escalones de consumo (0-200, 200-400, 400-500, etc.)? | CÃ¡lculo de cargo fijo |
| 5 | Â¿Los escalones son iguales para todas las tarifas? | LÃ³gica de cÃ¡lculo |
| 6 | Â¿Con quÃ© frecuencia cambian los valores de tarifas (resoluciones)? | Versionado de tarifas |

### 2.2 Sobre Cargos y Componentes

| # | Pregunta | Impacto |
|---|----------|---------|
| 7 | Â¿CÃ³mo se calcula exactamente el **Cargo Fijo**? Â¿Depende del escalÃ³n de consumo? | FÃ³rmula core |
| 8 | Â¿El **Cargo Variable** es siempre kWh Ã— precio unitario? | FÃ³rmula core |
| 9 | Â¿QuÃ© es el **CTT (Art 5Âº Res 2019-189)**? Â¿CÃ³mo se calcula? | Componente adicional |
| 10 | Â¿Por quÃ© PEREZ tiene CTT ~$9.93/kWh y CRINIGAN ~$4.25/kWh? | Diferencia por tarifa |
| 11 | Â¿CÃ³mo se calcula la **"Res. Asamblea 21/10/15"**? VarÃ­a mucho entre clientes | FÃ³rmula desconocida |
| 12 | Â¿El **Alumbrado PÃºblico** es fijo por zona? Â¿CuÃ¡ntas zonas hay? | ConfiguraciÃ³n |
| 13 | Â¿El cargo de **Bomberos** es siempre $960? | Valor fijo |

### 2.3 Sobre Impuestos y Leyes

| # | Pregunta | Impacto |
|---|----------|---------|
| 14 | Â¿El IVA siempre es 27% para Monotributistas y 21% para Consumidor Final? | Regla fiscal |
| 15 | Â¿Existen exenciones de IVA? Â¿Para quiÃ©nes? | Casos especiales |
| 16 | Â¿Los porcentajes de leyes provinciales (7290, 11769) son fijos o cambian? | ConfiguraciÃ³n |
| 17 | Â¿La base de cÃ¡lculo de los impuestos es siempre el Subtotal EnergÃ­a? | FÃ³rmula |

### 2.4 Sobre Subsidios y SegmentaciÃ³n

| # | Pregunta | Impacto |
|---|----------|---------|
| 18 | Â¿QuÃ© significa "SegmentaciÃ³n N1"? Â¿Hay otros niveles (N2, N3)? | CategorizaciÃ³n |
| 19 | Â¿CÃ³mo se calcula el **Subsidio Estado Nacional**? | FÃ³rmula de subsidio |
| 20 | Â¿El subsidio depende del consumo, la tarifa, o ambos? | Variables del subsidio |
| 21 | Â¿QuÃ© es "Sin Ahorro" que aparece en las facturas? | Estado del cliente |

### 2.5 Sobre Clientes/Abonados

| # | Pregunta | Impacto |
|---|----------|---------|
| 22 | Â¿CuÃ¡ntos abonados tiene COEMA aproximadamente? | Volumen de datos |
| 23 | Â¿QuÃ© datos del cliente son necesarios para facturar? | Modelo de datos |
| 24 | Â¿El nÃºmero de socio y el cÃ³digo de servicio son lo mismo? | Identificadores |
| 25 | Â¿Un cliente puede tener mÃºltiples servicios (medidores)? | Relaciones |

### 2.6 Sobre Lecturas y Medidores

| # | Pregunta | Impacto |
|---|----------|---------|
| 26 | Â¿Cada cuÃ¡nto se toman las lecturas actualmente? | Frecuencia |
| 27 | Â¿QuÃ© datos se registran en cada lectura? | Campos necesarios |
| 28 | Â¿CÃ³mo manejan las lecturas "estimadas" vs "reales"? | Flag en sistema |
| 29 | Â¿QuÃ© pasa si no se puede tomar lectura un mes? | Caso excepcional |

### 2.7 Sobre el PerÃ­odo de FacturaciÃ³n

| # | Pregunta | Impacto |
|---|----------|---------|
| 30 | Â¿Los perÃ­odos son siempre mensuales? | LÃ³gica temporal |
| 31 | Â¿CÃ³mo se maneja cuando el perÃ­odo cruza dos resoluciones tarifarias? | Prorrateo |
| 32 | Ejemplo: Factura con 27 dÃ­as de Res.1176/25 y 3 dÃ­as de Res.1176/25 Anexo 72 | Complejidad |

---

## 3. Datos Necesarios para la Demo

### 3.1 CatÃ¡logo de Tarifas

```
Necesitamos:
- Lista completa de tipos de tarifa (T1R, T1RE, comercial, etc.)
- DescripciÃ³n de cada tarifa
- Condiciones de aplicaciÃ³n
- Tipo de IVA aplicable
```

### 3.2 Valores de Tarifas Vigentes

```
Para cada tarifa y resoluciÃ³n:
- CÃ³digo de resoluciÃ³n (ej: Res.1176/25 Anexo 6)
- Fecha vigencia desde
- Fecha vigencia hasta
- Escalones de consumo (kWh desde - hasta)
- Cargo fijo por escalÃ³n
- Cargo variable ($/kWh) por escalÃ³n
- Valor CTT
```

**Ejemplo de estructura esperada:**

| ResoluciÃ³n | Tarifa | EscalÃ³n | kWh Desde | kWh Hasta | Cargo Fijo | $/kWh |
|------------|--------|---------|-----------|-----------|------------|-------|
| Res.1176/25 Anexo 6 | T1R | 3 | 200 | 400 | 6,895.82 | 165.40 |
| Res.1176/25 Anexo 6 | T1R | 4 | 400 | 500 | 8,846.72 | 173.62 |
| Res.1176/25 Anexo 6 | T1RE | 1 | 0 | 500 | 11,911.11 | 206.64 |

### 3.3 Tabla de Impuestos y Contribuciones

```
Para cada impuesto/contribuciÃ³n:
- CÃ³digo
- Nombre completo
- Porcentaje o valor fijo
- Base de cÃ¡lculo (subtotal energÃ­a, consumo, fijo)
- Aplicable a quÃ© tarifas
- Fecha vigencia
```

### 3.4 Datos de Clientes de Prueba

```
MÃ­nimo 5-10 clientes con diferentes:
- Tipos de tarifa
- Condiciones fiscales
- Niveles de segmentaciÃ³n
- Rangos de consumo histÃ³rico
```

### 3.5 Historial de Consumos

```
Para cada cliente de prueba:
- Ãšltimos 12 meses de consumo
- Lecturas de medidor
- Facturas emitidas (para validar cÃ¡lculos)
```

---

## 4. Requisitos Funcionales de la Demo

### 4.1 Inputs MÃ­nimos
- Identificador del servicio/abonado
- Consumo en kWh (o lectura actual si tenemos la anterior)

### 4.2 Outputs Esperados
- Desglose completo de la factura
- Subtotales por categorÃ­a (EnergÃ­a, Leyes, Otros)
- Total a pagar
- GrÃ¡fico comparativo con perÃ­odos anteriores
- Comparativa con promedio de su categorÃ­a

### 4.3 Funcionalidades Deseadas
1. **Calculadora de factura** - Input: kWh â†’ Output: Factura detallada
2. **Simulador de consumo** - "Â¿CuÃ¡nto pagarÃ­a si consumo X kWh?"
3. **HistÃ³rico de cliente** - Ver evoluciÃ³n de consumo y facturaciÃ³n
4. **Comparador de tarifas** - Mostrar diferencias entre T1R y T1RE

---

## 5. EvaluaciÃ³n de TecnologÃ­as

### 5.1 OpciÃ³n A: Directus + Frontend

**Pros:**
- API REST/GraphQL lista para usar
- Panel de administraciÃ³n incluido
- Sistema de permisos y roles robusto
- Webhooks y Flows para automatizaciones
- Ideal para integraciÃ³n con sistemas externos
- Ya conocido por el equipo

**Contras:**
- Requiere hosting (VPS o cloud)
- MÃ¡s complejo para una demo simple
- Overhead si solo necesitamos cÃ¡lculos

**Ideal para:** SoluciÃ³n productiva a largo plazo

---

### 5.2 OpciÃ³n B: Streamlit (Python)

**Pros:**
- Deploy instantÃ¡neo (Streamlit Cloud gratuito)
- Excelente para demos y prototipos
- GrÃ¡ficos interactivos nativos (Plotly, Altair)
- CÃ³digo Python puro (fÃ¡cil de mantener)
- Widgets de input listos (sliders, selectbox, etc.)
- Hot reload durante desarrollo

**Contras:**
- No tiene base de datos integrada (usar SQLite/PostgreSQL)
- No ideal para producciÃ³n con muchos usuarios
- Sin sistema de autenticaciÃ³n robusto nativo

**Ideal para:** Demo rÃ¡pida y prototipo funcional

**Ejemplo de cÃ³digo Streamlit:**
```python
import streamlit as st

st.title("ğŸ”Œ Calculadora de Factura COEMA")

cliente = st.selectbox("Seleccione cliente", ["PEREZ - T1R", "CRINIGAN - T1RE"])
consumo = st.number_input("Consumo (kWh)", min_value=0, max_value=1000, value=422)

if st.button("Calcular Factura"):
    # LÃ³gica de cÃ¡lculo
    factura = calcular_factura(cliente, consumo)
    st.dataframe(factura)
    st.bar_chart(factura[["Concepto", "Importe"]])
```

---

### 5.3 OpciÃ³n C: Gradio (Python)

**Pros:**
- Similar a Streamlit, aÃºn mÃ¡s simple
- Deploy en Hugging Face Spaces (gratuito)
- Interfaces generadas automÃ¡ticamente
- Bueno para demos de "input â†’ output"

**Contras:**
- Menos flexible que Streamlit
- Menos widgets disponibles
- Comunidad mÃ¡s pequeÃ±a

**Ideal para:** Demos muy simples tipo calculadora

---

### 5.4 OpciÃ³n D: FastAPI + React/Vue

**Pros:**
- MÃ¡xima flexibilidad
- API documentada automÃ¡ticamente (OpenAPI/Swagger)
- Frontend totalmente personalizable
- Escalable a producciÃ³n

**Contras:**
- Mayor tiempo de desarrollo
- Requiere conocimiento de frontend
- MÃ¡s cÃ³digo que mantener

**Ideal para:** SoluciÃ³n productiva personalizada

---

### 5.5 OpciÃ³n E: NiceGUI (Python)

**Pros:**
- UI moderna con Python puro
- Basado en Vue.js/Quasar
- MÃ¡s componentes que Streamlit
- Mejor para aplicaciones complejas

**Contras:**
- Menos popular (comunidad pequeÃ±a)
- DocumentaciÃ³n limitada

**Ideal para:** Apps Python mÃ¡s elaboradas

---

### 5.6 Matriz de DecisiÃ³n

| Criterio | Peso | Directus | Streamlit | Gradio | FastAPI+React | NiceGUI |
|----------|------|----------|-----------|--------|---------------|---------|
| Velocidad de desarrollo | 25% | 3 | 5 | 5 | 2 | 4 |
| Facilidad de demo | 20% | 3 | 5 | 5 | 3 | 4 |
| Escalabilidad | 15% | 5 | 2 | 1 | 5 | 3 |
| IntegraciÃ³n API | 15% | 5 | 3 | 2 | 5 | 3 |
| GrÃ¡ficos/VisualizaciÃ³n | 10% | 2 | 5 | 4 | 4 | 4 |
| Costo de hosting | 10% | 2 | 5 | 5 | 3 | 4 |
| Mantenibilidad | 5% | 4 | 4 | 3 | 3 | 3 |
| **TOTAL** | 100% | **3.35** | **4.25** | **3.85** | **3.35** | **3.65** |

*(Escala: 1=Malo, 5=Excelente)*

---

### 5.7 RecomendaciÃ³n

#### Para la DEMO inicial: **Streamlit** â­

**Razones:**
1. Prototipo funcional en 1-2 dÃ­as
2. Deploy gratuito en Streamlit Cloud
3. GrÃ¡ficos interactivos incluidos
4. FÃ¡cil de modificar segÃºn feedback
5. El cliente puede ver y probar inmediatamente

#### Para PRODUCCIÃ“N futura: **Directus + Streamlit** o **FastAPI + Frontend**

**Estrategia sugerida:**
1. **Fase 1 (Demo):** Streamlit con datos hardcodeados o SQLite
2. **Fase 2 (ValidaciÃ³n):** Conectar Streamlit a Directus como backend
3. **Fase 3 (ProducciÃ³n):** Migrar a arquitectura completa si es necesario

---

## 6. Arquitectura Propuesta para Demo

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    STREAMLIT APP                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  Input      â”‚  â”‚  CÃ¡lculo    â”‚  â”‚  Output     â”‚     â”‚
â”‚  â”‚  - Cliente  â”‚â”€â–¶â”‚  - Tarifas  â”‚â”€â–¶â”‚  - Factura  â”‚     â”‚
â”‚  â”‚  - kWh      â”‚  â”‚  - Impuestosâ”‚  â”‚  - GrÃ¡ficos â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    DATOS (JSON/SQLite)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  Clientes   â”‚  â”‚  Tarifas    â”‚  â”‚  Impuestos  â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. PrÃ³ximos Pasos

1. [ ] Enviar cuestionario a COEMA (secciÃ³n 2)
2. [ ] Recibir y procesar datos de tarifas vigentes
3. [ ] Recibir clientes de prueba con historial
4. [ ] Desarrollar demo en Streamlit
5. [ ] Validar cÃ¡lculos con facturas reales
6. [ ] Presentar demo a COEMA
7. [ ] Iterar segÃºn feedback
8. [ ] Definir arquitectura de producciÃ³n

---

## 8. Anexo: Facturas Analizadas

### Facturas de Referencia

| Documento | Cliente | Tarifa | PerÃ­odo | Consumo | Total |
|-----------|---------|--------|---------|---------|-------|
| A-0002-00098631 | PEREZ DIEGO | T1R | Dic 2025 | 422 kWh | $137,909.74 |
| A-0002-00097256 | PEREZ DIEGO | T1R | Nov 2025 | 296 kWh | $90,713.36 |
| B-0002-01278775 | CRINIGAN MARIA | T1RE | Dic 2025 | 170 kWh | $79,270.15 |
| B-0002-01268771 | CRINIGAN MARIA | T1RE | Nov 2025 | 44 kWh | $37,642.79 |

---

*Documento generado para anÃ¡lisis interno. Pendiente de validaciÃ³n con COEMA.*